## select

将已连接的 Socket 都放到一个**文件描述符集合**，然后调用 select 函数将文件描述符集合**拷贝**到内核里，让内核来检查是否有网络事件产生，检查的方式很粗暴，就是通过**遍历**文件描述符集合的方式，

当检查到有事件产生后，将此 Socket 标记为可读或可写， 接着再把整个文件描述符集合**拷贝**回用户态里，然后用户态还需要再通过**遍历**的方法找到可读或可写的 Socket，然后再对其处理。



对于 select 这种方式，需要进行 **2 次「遍历」文件描述符集合**，一次是在内核态里，一个次是在用户态里 ，而且还会发生 **2 次「拷贝」文件描述符集合**，先从用户空间传入内核空间，由内核修改后，再传出到用户空间中。



**select的几大缺点：**

（1）将多个文件描述符（fd）放入一个`数组`,每次调用select，都需要把fd集合从用户态拷贝到内核态，这个开销在fd很多时会很大

（2）同时每次调用select都需要在内核遍历传递进来的所有fd，这个开销在fd很多时也很大

（3）select支持的文件描述符数量太小了，默认是1024

​	(4) 文件描述符集(fd_set)不可重用

**优点：**

1、select的可移植性更好，在某些Unix系统上不支持poll()。

2、select对于超时值提供了更好的精度：微秒，而poll是毫秒。



**3.3 执行流程**

第一步：将用户态rset拷贝到内核态中，如下图所示，

第二步：遍历文件描述符，判断是否数据可读，

第三步：如没有数据，将在内核中阻塞。

第四步：如有数据，1.将fd_set 置位(有数据)，2.select 返回

![](https://youpaiyun.zongqilive.cn/image/20210314181433.png)









