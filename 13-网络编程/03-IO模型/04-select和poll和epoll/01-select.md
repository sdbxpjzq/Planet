## select

select 的核心功能是调用tcp文件系统的poll函数，不停的查询，如果没有想要的数据，主动执行一次调度（防止一直占用cpu），直到有一个连接有想要的消息为止。从这里可以看出select的执行方式基本就是不同的调用poll,直到有需要的消息为止。



**select的几大缺点：**

（1）将多个文件描述符（fd）放入一个`数组`,每次调用select，都需要把fd集合从用户态拷贝到内核态，这个开销在fd很多时会很大

（2）同时每次调用select都需要在内核遍历传递进来的所有fd，这个开销在fd很多时也很大

（3）select支持的文件描述符数量太小了，默认是1024

​	(4) 文件描述符集(fd_set)不可重用

**优点：**

1、select的可移植性更好，在某些Unix系统上不支持poll()。

2、select对于超时值提供了更好的精度：微秒，而poll是毫秒。



**3.3 执行流程**

第一步：将用户态rset拷贝到内核态中，如下图所示，

第二步：遍历文件描述符，判断是否数据可读，

第三步：如没有数据，将在内核中阻塞。

第四步：如有数据，1.将fd_set 置位(有数据)，2.select 返回

![](https://youpaiyun.zongqilive.cn/image/20210314181433.png)









