这个方法在美团的Leaf中有介绍，详情可以参考美团技术团队的发布的技术文章:Leaf——美团点评分布式ID生成系统,这个方案是将数据库主键自增进行优化。

![](https://youpaiyun.zongqilive.cn/image/20210311092850.png)

biz_tag代表每个不同的业务，max_id代表每个业务设置的大小，step代表每个proxyServer缓存的步长。
之前我们的每个服务都访问的是数据库，现在不需要，每个服务直接和我们的ProxyServer做交互，减少了对数据库的依赖。我们的每个ProxyServer回去数据库中拿出步长的长度，比如server1拿到了1-1000,server2拿到来 1001-2000。如果用完会再次去数据库中拿。



优点:

- 比主键递增性能高，能保证趋势递增。
- 如果DB宕机，proxServer由于有缓存依然可以坚持一段时间。

缺点:

- 和主键递增一样，容易被人猜测。
- DB宕机，虽然能支撑一段时间但是仍然会造成系统不可用。



适用场景:

需要趋势递增，并且ID大小可控制的，可以使用这套方案。

当然这个方案也可以通过一些手段避免被人猜测，把ID变成是无序的，比如把我们生成的数据是一个递增的long型，把这个Long分成几个部分，比如可以分成几组三位数，几组四位数，然后在建立一个映射表，将我们的数据变成无序



















