InnoDB存储引擎的锁算法的一些规则如下所示. 都是在Mysql的默认 RR级别下讨论.

```sql
select * from t3 where num = 4 for update;
num
1
4
7
10
```

## num是主键索引

降级为行锁,  对当前行加X锁.

## num是唯一键索引

对 普通索引上对应的一行记录加排他锁

对主键索引上对应的记录加排他锁

## num是普通索引

上边的会锁住`(1,4],(4,7)`, 既Next-key Lock



## num无索引

扫描所有的行加X锁和间隙锁, , (像是加了表锁), 所以建议where条件要命中索引.



## num主键索引, 值不存在

会形成间隙锁, -- (x, y) 

## num唯一索引索引, 值不存在

会形成间隙锁, -- (x, y) 

## num普通索引, 值不存在

会形成间隙锁, -- (x, y) 

## num无索引, 值不存在

扫描所有的行加X锁和间隙锁, , (像是加了表锁), 所以建议where条件要命中索引.





