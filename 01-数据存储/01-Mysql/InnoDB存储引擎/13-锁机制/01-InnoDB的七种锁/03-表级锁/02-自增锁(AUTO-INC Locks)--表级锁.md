## 自增锁(AUTO-INC Locks)

- AUTO-INC锁是一种特殊的表级锁，发生涉及`AUTO_INCREMENT列`的事务性插入操作时产生。

- 最简单的情况，如果一个事务正在往表中插入记录，所有其他事务的插入必须等待，以便第一个事务插入的行，是连续的主键值。
-  这个锁是在insert操作完成之后立即释放，而不是等待事务提交.(插入的时候仅仅需要等待上一条记录插入完成，不必等待上一个事务提交。)
- 与此同时，InnoDB 提供了 `innodb_autoinc_lock_mode` 配置，可以调节与改变该锁的模式与行为。 

- 自增长的属性可以避免在数据插入的时候，出现大量的数据页分裂操作.





![](https://youpaiyun.zongqilive.cn/image/20200915155833.png)

![](https://youpaiyun.zongqilive.cn/image/20200915155900.png)





## innodb_autoinc_lock_mode的参数

innodb_autoinc_lock_mode的参数来控制自增长的模式，这个参数默认值是1，总共可以设置三个值0,1,2

**设置为0：**(已淘汰)

  则采用普通的auto-inc Locking方式，这种模式已经被淘汰。**但是它生成的id值一定是连续的。**



**设置为1：**(默认)

混合模式

 对于insert、replace等能够确定插入数据量的操作会使用一个更轻量级的互斥自增长机制去实现，官方称之为mutex， 暂时可以理解为一种更优化的方法即可; 这种方式下，不考虑回滚操作，生成的id是连续的。如果有回滚操作，则不一定连续。



**设置为2：**

  在这种模式下，针对所有的insert类型的语句，包括insert，insert...select...,load data、replace...select...等等操作，都是通过mutex的优化操作去实现的，这种方法的性能最高，但是安全性不能得到保证，**生成的id可能是不连续的**，而且几乎statement模式的复制可能会出现问题。这种模式下主从复制必须使用基于row的复制模式。



> 随着数字的上升，安全性下降，但是效率提高，所以默认的参数取得是中间值































