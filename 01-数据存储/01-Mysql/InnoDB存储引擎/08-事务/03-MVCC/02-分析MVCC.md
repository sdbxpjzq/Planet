以“可重复读”级别为例。

- 当一个事务开启的时候，会向系统申请一个新事务id
- 此时，可能还有多个正在进行的其他事务没有提交，因此在瞬时时刻，是有多个活跃的未提交事务id
- 将这些未提交的事务id组成一个数组，数组里面最小的事务id记录为低水位，当前系统创建过的事务id的最大值+1记录为高水位
- 这个数组array 和 高水位，就组成了“一致性视图”。

![](https://youpaiyun.zongqilive.cn/image/20210319093733.png)

> 一共5种情况: 
>
> - 落在绿色，表明该版本是由已提交的事务或当前事务自己生成的，这个数据更新结果自然是可见的
> - 落在红色，该版本由将来启动的事务生成，不可见
> - 落在黄色，包括两种情况
>   a.row trx_id在数组，表示这个版本是由还没提交的事务生成，不可见
>   b.row trx_id不在数组，表示这个版本是已经提交了的事务生成，可见



> MVCC的实现，是通过保存数据在某个时间点的快照来实现的。
>
> 因此一个事务只需在启动时声明：以我启动时刻为准
>
> 如果一个数据版本是在我启动前生成的，就认
>
> 启动后才生成的，我不认，必须要找到它的上一个版本
>
> 若“上个版本”也不可见，那就继续往前找
>
> 如果是这个事务自己更新的数据，自己还是认的。









