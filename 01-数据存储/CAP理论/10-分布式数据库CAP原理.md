### CAP

CAP定理，又被叫作布鲁尔定理。对于设计分布式系统来说(不仅仅是分布式事务)的架构师来说，CAP就是你的入门理论。

- `C (一致性)`:对某个指定的客户端来说，读操作能返回最新的写操作。对于数据分布在不同节点上的数据上来说，如果在某个节点更新了数据，那么在其他节点如果都能读取到这个最新的数据，那么就称为强一致，如果有某个节点没有读取到，那就是分布式不一致。
- `A (可用性)`：非故障的节点在合理的时间内返回合理的响应(不是错误和超时的响应)。可用性的两个关键一个是合理的时间，一个是合理的响应。合理的时间指的是请求不能无限被阻塞，应该在合理的时间给出返回。合理的响应指的是系统应该明确返回结果并且结果是正确的，这里的正确指的是比如应该返回50，而不是返回40。
- `P (分区容错性)`:当出现网络分区后，系统能够继续工作。打个比方，这里个集群有多台机器，有台机器网络出现了问题，但是这个集群仍然可以正常工作。



对于CP来说，放弃可用性，追求一致性和分区容错性，我们的zookeeper其实就是追求的强一致。

对于AP来说，放弃一致性(这里说的一致性是强一致性)，追求分区容错性和可用性，这是很多分布式系统设计时的选择，后面的BASE也是根据AP来扩展。

顺便一提，CAP理论中是忽略网络延迟，也就是当事务提交时，从节点A复制到节点B，但是在现实中这个是明显不可能的，所以总会有一定的时间是不一致。同时CAP中选择两个，比如你选择了CP，并不是叫你放弃A。因为P出现的概率实在是太小了，大部分的时间你仍然需要保证CA。就算分区出现了你也要为后来的A做准备，比如通过一些日志的手段，是其他机器回复至可用。



## C: Consistency(强一致性) 

 所有节点同一时间看到是相同的数据；

分布式系统中，一份数据一般会存在多个副本，要求多副本数据对于数据的更新与单份数据相同，即强一致性。

> 任何读请求都必须返回最新数据

## A: Availability(可用性) 

 不管是否成功，确保每一个请求都能接收到响应；

在任意的时刻，对分布式系统来说要保证在限定延时内正常响应客户端的读写请求，并且不会报错。（提前纠正一个误区，这里的可用性并不是咱们通常理解的服务的SLA可用性，即3个9、4个9之类的定义。实际上指的是是数据访问的可达性。）

> 所有读写请求都必须正常响应，可终止、不会一直等待

## P: Partition tolerance(分区容错性) 

系统任意分区后，在网络故障时，仍能操作

在分布式服务中，节点之间网络通信异常导致(丢包、延迟、中断等)的网络分区现象是必然存在的，要保证出现网络分区现象时，分布式系统不受影响。

> 在网络分区的情况下，被分隔的节点仍能正常对外服务

##  CAP理论的核心

一个分布式系统不可能同时很好的满足一致性, 可用性和分区容错性 , 

CA -- 单点集群, 满足一致性, 可用性, 通常在可扩展性上不太强大

CP -- 满足一致性, 分区容错性的系统, 通常性能不是特别高

AP -- 满足可用性, 分区容错性的系统, 通常可能对一致性要求低一些



![](https://youpaiyun.zongqilive.cn/image/20201116110345.png)

![](https://youpaiyun.zongqilive.cn/image/20200610170605.png)





 

 







































































