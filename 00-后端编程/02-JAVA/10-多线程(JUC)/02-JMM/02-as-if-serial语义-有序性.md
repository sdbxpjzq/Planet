## as-if-serial语义

> ```apl
> 它不保证程序中各个语句的执行先后顺序同代码中的顺序一致,
> 但是它会保证(单线程)程序最终执行结果和代码顺序执行的结果是一致的.
> ```

意思是：==不管怎么重排序，（单线程）的执行结果不会改变。==

编译器、runtime和处理器都必须遵守as-if-serial语义.

为了遵守as-if-serial语义，编译器和处理器不会对存在数据依赖关系的操作做重排序，因为这种重排序会改变执行结果。

但是，如果操作之间不存在数据依赖关系，这些操作就可能被编译器和处理器重排序。





## as-if-serial VS happens-before

1. as-if-serial语义保证单线程内程序的执行结果不被改变，happens-before关系保证正确同步的多线程程序的执行结果不被改变。

2. as-if-serial语义给编写单线程程序的程序员创造了一个幻境：单线程程序是按程序的顺序来执行的。happens-before关系给编写正确同步的多线程程序的程序员创造了一个幻境：正确同步的多线程程序是按happens-before指定的顺序来执行的。

3. as-if-serial语义和happens-before这么做的目的，都是为了在不改变程序执行结果的前提下，尽可能地提高程序执行的并行度。




