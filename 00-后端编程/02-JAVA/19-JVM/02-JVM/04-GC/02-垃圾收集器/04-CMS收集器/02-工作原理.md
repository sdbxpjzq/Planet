## 工作原理

![](https://youpaiyun.zongqilive.cn/image/20210116173113.png)



![](https://youpaiyun.zongqilive.cn/image/20200609105944.png)

 

整个过程分为4个主要阶段:

1. 初始标记阶段(Initial-Mark)

   ==触发STW==，并记录下gc roots直接能引用的对象，速度很快 ;

2. 并发标记阶段

   ==GC和用户线程 同时执行==，寻找可达对象。从GC Roots的对象开始遍历, 这个过程耗时较长, 但是不需要停顿用户线程

   但在这个阶段 结束，这个闭包结构并不能保证包含当前所有的可达对象。因为用户线程可能会不断的更新 引用域，所以GC线程无法保证可达性分析的实时性。所以这个算法里会跟踪记录这些发生引 用更新的地方。

3. 重新标记阶段(Remark)

   ==触发STW==

    为了修正并发标记期间因为用户程序继续运行而导致标记 产生变动的那一部分对象的标记记录，这个阶段的停顿时间一般会比初始标记阶段的时间稍 长，远远比并发标记阶段时间短

4. 并发清除阶段(Concurrent-Sweep)

   ==GC和用户线程 同时执行==, GC线程开始对未标记的区域做清扫

![](https://youpaiyun.zongqilive.cn/image/20200425150528.png)

